// src/i18n/domL10n.js

// --- 1) Žodynai (palik tuos pačius, tik sutrumpinau pavyzdžiui) ---
const MAP = {
  en: {
    "Pradžia": "Home",
    "Produktai": "Products",
    "Visi produktai": "All products",
    "Nauji": "New",
    "Populiariausi": "Popular",
    "Su nuolaida": "On sale",
    "Kategorijos": "Categories",
    "Atlikti darbai": "Projects",
    "Kalba": "Language",
    "Krepšelis": "Cart",

    "Grindims": "For floors",
    "Sienoms": "For walls",
    "Prabangūs": "Luxury",
    "Kiti": "Other",

    "Mūsų produktai": "Our products",
    "Mūsų naujausi produktai": "Our latest products",
    "Mūsų naujausi produktai jūsų namams": "Our latest products for your home",
    "Išskirtinis akmuo Jūsų projektams tiesisiai iš Indijos": "Exclusive stone for your projects directly from India",
    "Natūrali tekstūra • Ilgaamžis ir gražus taipogi isskirtinio grozio":
      "Natural texture • Durable and distinct beauty",

    "Paieška...": "Search...",
    "Spalva": "Color",
    "Kategorija": "Category",
    "Rūšiuoti": "Sort",
    "Kaina nuo": "Price from",
    "Kaina iki": "Price to",
    "Panaikinti filtrus": "Clear filters",
    "Pavadinimas A–Ž": "Title A–Z",
    "Pavadinimas Ž–A": "Title Z–A",
    "Kaina ↑": "Price ↑",
    "Kaina ↓": "Price ↓",
    "Nerasta.": "No results.",
    "Peržiūrėti": "View",
    "Į krepšelį": "Add to cart",
    "Kiekis": "Quantity",
    "Aprašymas": "Description",

    "Krepšelis tuščias.": "Your cart is empty.",
    "Pirkti": "Checkout",
    "Produktas": "Product",
    "Kaina": "Price",
    "Kiekis": "Qty",
    "Tarpinė suma": "Subtotal",
    "Bendra suma": "Total",
    "Užsakymo peržiūra": "Order review",
    "Pristatymo duomenys": "Shipping details",
    "Vardas": "Name",
    "El. paštas": "Email",
    "Telefonas (nebūtinas)": "Phone (optional)",
    "Adresas": "Address",
    "Pastabos": "Notes",
    "Pateikti užsakymą": "Place order",

    "Nuorodos": "Links",
    "Apie mus": "About",
    "Kontaktai": "Contact",
    "Privatumo politika": "Privacy policy",
    "Taisyklės": "Terms",
    "Natūralaus akmens sprendimai grindims, sienoms ir fasadams.":
      "Natural stone solutions for floors, walls and facades.",
    "Visos teisės saugomos.": "All rights reserved.",

    // visas footer
    "about.title": "About us",
    "about.p1":
      "“Stones” is a small, attentive team working with natural stone for several years. Our goal is to help you choose the most suitable stone for your projects: from floors and walls to outdoor paths or decorative solutions. We value simplicity, transparent pricing and reliable service.",
    "about.p2":
      "We work with trusted suppliers and make sure every client gets quality materials and advice. If needed, we send samples, help calculate quantities and arrange delivery.",
    "contact.p1": "Have questions? Write to us — we’ll reply shortly.",
    "privacy.p1": `We respect your privacy. We process personal data in accordance with the GDPR and other applicable laws. We use data (name, email, address) only for order administration, invoicing and delivery. We do not share data with third parties, except necessary service providers (e.g., couriers).
     You have the right to access, correct or request deletion of your data. For data rights, contact us at: info@akmenys.lt.
     Cookies are used to improve website functionality and statistics. You can control cookie settings in your browser.`,
     "terms.p1": `The purchase–sale agreement is considered concluded from the moment the order is confirmed.
     Prices are shown in EUR including VAT. Delivery times and cost are specified at the time of ordering. The buyer undertakes to provide correct data and accept delivery at the agreed address.
     Returns are possible within 14 days if the item has not been used and is in its original packaging. The color and texture of natural stone may slightly differ from photos—this is not a manufacturing defect.
     If you have any questions — info@akmenys.lt.`,
    // herocarusel
    "hero2.title" : "The beauty of natural stone",
    "hero2.text"  : "Discover carefully selected stones for floors, walls and facades.",
    "hero2.cta" : "View all products",
    // herolanding
    "hero1.title" : "Exclusive stone for your projects",
    "hero1.subtitle" : "Natural texture • Timeless beauty",
    "hero1.cta" : "Our products for you",

  },
 


  no: {
    "Pradžia": "Hjem",
    "Produktai": "Produkter",
    "Visi produktai": "Alle produkter",
    "Nauji": "Nye",
    "Populiariausi": "Populære",
    "Su nuolaida": "På salg",
    "Kategorijos": "Kategorier",
    "Atlikti darbai": "Prosjekter",
    "Kalba": "Språk",
    "Krepšelis": "Handlekurv",

    "Grindims": "Til gulv",
    "Sienoms": "Til vegg",
    "Prabangūs": "Eksklusiv",
    "Kiti": "Annet",

    "Mūsų produktai": "Våre produkter",
    "Mūsų naujausi produktai": "Våre nyeste produkter",
    "Mūsų naujausi produktai jūsų namams": "Våre nyeste produkter til hjemmet",
    "Išskirtinis akmuo Jūsų projektams tiesisiai iš Indijos": "Eksklusiv stein til dine prosjekter direkte fra India",
    "Natūrali tekstūra • Ilgaamžis ir gražus taipogi isskirtinio grozio":
      "Naturlig tekstur • Holdbar og unik skjønnhet",

    "Paieška...": "Søk...",
    "Spalva": "Farge",
    "Kategorija": "Kategori",
    "Rūšiuoti": "Sorter",
    "Kaina nuo": "Pris fra",
    "Kaina iki": "Pris til",
    "Panaikinti filtrus": "Tøm filtre",
    "Pavadinimas A–Ž": "Tittel A–Å",
    "Pavadinimas Ž–A": "Tittel Å–A",
    "Kaina ↑": "Pris ↑",
    "Kaina ↓": "Pris ↓",
    "Nerasta.": "Ingen treff.",
    "Peržiūrėti": "Vis",
    "Į krepšelį": "Legg i handlekurv",
    "Kiekis": "Antall",
    "Aprašymas": "Beskrivelse",

    "Krepšelis tuščias.": "Handlekurven er tom.",
    "Pirkti": "Til kassen",
    "Produktas": "Produkt",
    "Kaina": "Pris",
    "Kiekis": "Ant.",
    "Tarpinė suma": "Delsum",
    "Bendra suma": "Total",
    "Užsakymo peržiūra": "Ordreoversikt",
    "Pristatymo duomenys": "Leveringsdetaljer",
    "Vardas": "Navn",
    "El. paštas": "E-post",
    "Telefonas (nebūtinas)": "Telefon (valgfritt)",
    "Adresas": "Adresse",
    "Pastabos": "Notater",
    "Pateikti užsakymą": "Fullfør bestilling",

    "Nuorodos": "Lenker",
    "Apie mus": "Om oss",
    "Kontaktai": "Kontakt",
    "Privatumo politika": "Personvern",
    "Taisyklės": "Vilkår",
    "Natūralaus akmens sprendimai grindims, sienoms ir fasadams.":
      "Natursteinsløsninger for gulv, vegger og fasader.",
    "Visos teisės saugomos.": "Alle rettigheter forbeholdt.",

    "about.title": "Om oss",
    "about.p1":
      "“Steins” er et lite, oppmerksomt team som har jobbet med naturstein i flere år. Vårt mål er å hjelpe deg å velge riktig stein til prosjektene dine: fra gulv og vegger til utendørs stier eller dekorative løsninger. Vi verdsetter enkelhet, tydelige priser og pålitelig service.",
    "about.p2":
      "Vi samarbeider med pålitelige leverandører og sørger for at hver kunde får materialer av høy kvalitet og god rådgivning. Ved behov sender vi prøver, hjelper med mengdeberegning og organiserer levering.",
    "contact.p1": "Har du spørsmål? Skriv til oss — vi svarer snart.",
    "privacy.p1": `Vi respekterer ditt personvern. Vi behandler personopplysninger i samsvar med GDPR og gjeldende lover. Vi bruker data (navn, e-post, adresse) kun til ordrebehandling, fakturering og levering. Vi deler ikke data med tredjeparter, bortsett fra nødvendige tjenesteleverandører (f.eks. bud).
     Du har rett til innsyn, korrigering eller sletting av dine data. For henvendelser om datarettigheter: info@akmenys.lt.
     Informasjonskapsler brukes for å forbedre nettstedets funksjonalitet og statistikk. Du kan styre innstillingene i nettleseren.`,
     "terms.p1": `Kjøpsavtalen anses inngått fra det øyeblikket bestillingen bekreftes.
     Prisene er oppgitt i EUR inkludert MVA. Leveringstid og pris avklares ved bestilling. Kjøperen forplikter seg til å oppgi korrekte opplysninger og motta levering på avtalt adresse.
     Retur er mulig innen 14 dager dersom varen ikke er brukt og er i originalemballasjen. Natursteinens farge og tekstur kan avvike noe fra bilder—dette er ikke en produksjonsfeil.
     Ved spørsmål — info@akmenys.lt.`,
     // herocarusel
     "hero2.title" : "Natursteinens skjønnhet",
     "hero2.text" : "Oppdag nøye utvalgte steiner for gulv, vegger og fasader.",
     "hero2.cta" : "Se alle produkter",
     // herolanding
     "hero1.title" : "Eksklusiv stein for dine prosjekter",
     "hero1.subtitle" : "Naturlig tekstur • Tidløs skjønnhet",
     "hero1.cta" : "Våre produkter for deg",

    }
};

// --- 2) Originalių reikšmių saugojimas (kad LT grąžintume tiksliai) ---
function storeOrigOnce(el, key, val) {
  if (!el.hasAttribute(key)) el.setAttribute(key, val ?? '');
}
function restoreOrig(el, key, apply) {
  const v = el.getAttribute(key);
  if (v != null) apply(v);
}

// --- 3) Vieno elemento vertimas ---
function translateElement(el, dict, lang) {
  // data-i18n (tekstui)
  if (el.hasAttribute('data-i18n')) {
    const k = el.getAttribute('data-i18n');
    storeOrigOnce(el, 'data-i18n-orig', el.textContent);
    if (lang === 'lt') {
      restoreOrig(el, 'data-i18n-orig', v => { if (el.textContent !== v) el.textContent = v; });
    } else if (dict && dict[k] && el.textContent !== dict[k]) {
      el.textContent = dict[k];
    }
  }

  // placeholder
  if (el.hasAttribute('data-i18n-placeholder')) {
    const k = el.getAttribute('data-i18n-placeholder');
    const cur = el.getAttribute('placeholder') || '';
    storeOrigOnce(el, 'data-i18n-orig-ph', cur);
    if (lang === 'lt') {
      restoreOrig(el, 'data-i18n-orig-ph', v => { if (el.getAttribute('placeholder') !== v) el.setAttribute('placeholder', v); });
    } else if (dict && dict[k]) {
      if (el.getAttribute('placeholder') !== dict[k]) el.setAttribute('placeholder', dict[k]);
    }
  }

  // title
  if (el.hasAttribute('data-i18n-title')) {
    const k = el.getAttribute('data-i18n-title');
    const cur = el.getAttribute('title') || '';
    storeOrigOnce(el, 'data-i18n-orig-tt', cur);
    if (lang === 'lt') {
      restoreOrig(el, 'data-i18n-orig-tt', v => { if (el.getAttribute('title') !== v) el.setAttribute('title', v); });
    } else if (dict && dict[k]) {
      if (el.getAttribute('title') !== dict[k]) el.setAttribute('title', dict[k]);
    }
  }

  // Fallback: literalų keitimas tekstiniuose mazguose (tik jei ne LT ir turim dict)
  if (lang !== 'lt' && dict) {
    for (let n = el.firstChild; n; n = n.nextSibling) {
      if (n.nodeType === 3) {
        const raw = n.nodeValue;
        const trimmed = raw.trim();
        if (trimmed && dict[trimmed]) {
          const replaced = raw.replace(trimmed, dict[trimmed]);
          if (replaced !== raw) n.nodeValue = replaced;
        }
      }
    }
    // be data-* raktų: pamėginkim placeholder/title literalus
    if (el.nodeType === 1) {
      if (el.hasAttribute('placeholder')) {
        const ph = el.getAttribute('placeholder');
        if (dict[ph] && ph !== dict[ph]) el.setAttribute('placeholder', dict[ph]);
      }
      if (el.hasAttribute('title')) {
        const tt = el.getAttribute('title');
        if (dict[tt] && tt !== dict[tt]) el.setAttribute('title', dict[tt]);
      }
    }
  }
}

function translateAll(dict, lang) {
  const tw = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT, null);
  while (tw.nextNode()) translateElement(tw.currentNode, dict, lang);
}

// --- 4) Viešoji API su saugia stebėsena ---
let observer = null;
let scheduled = false;
let lastDict = null;
let lastLang = 'lt';

function scheduleApply() {
  if (scheduled) return;
  scheduled = true;
  requestAnimationFrame(() => {
    scheduled = false;
    translateAll(lastDict, lastLang);
  });
}

export function applyDomL10n(lang = 'lt') {
  // sustabdom seną observer, jei buvo
  if (observer) { observer.disconnect(); observer = null; }

  lastLang = lang;
  lastDict = lang === 'lt' ? null : (MAP[lang] || null);

  // pritaikom iškart
  translateAll(lastDict, lastLang);

  // stebim tik elementų pridėjimą/šalinimą (be attributes/characterData!)
  observer = new MutationObserver(() => {
    scheduleApply();
  });
  observer.observe(document.body, { childList: true, subtree: true });
}
